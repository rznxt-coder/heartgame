<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>For Chinny üíñ</title>
  <meta name="description" content="A tiny web game for Chinny ‚Äî catch the hearts!" />
  <style>
    :root{
      --bg1:#ffe1ec; --bg2:#ffd2e1; --accent:#ff3b7c; --accent2:#ff7aa8; --text:#2a2a2a;
      --glass: rgba(255,255,255,.7);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text); background: linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow:hidden; /* prevent scroll on mobile */
    }

    /* Canvas fills the screen */
    #game{ position:fixed; inset:0; display:block; width:100vw; height:100vh; }

    /* HUD */
    .hud{ position:fixed; top:0; left:0; right:0; display:flex; gap:.75rem; flex-wrap:wrap;
      padding: .75rem .75rem; align-items:center; justify-content:space-between; pointer-events:none; }
    .pill{ pointer-events:auto; backdrop-filter:saturate(140%) blur(6px); background:var(--glass);
      border:1px solid rgba(255,255,255,.6); padding:.5rem .8rem; border-radius:999px; display:flex; gap:.5rem; align-items:center; box-shadow:0 8px 20px rgba(0,0,0,.08)}
    .score{ font-weight:700 }
    .btn{ cursor:pointer; user-select:none; }

    /* Center start screen */
    .center{ position:fixed; inset:0; display:grid; place-items:center; }
    .card{ width:min(92vw,700px); text-align:center; background:rgba(255,255,255,.85); border-radius:24px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,.15); border:1px solid #fff }
    .title{ font-size: clamp(28px, 6vw, 48px); line-height:1.05; margin:8px 0 4px }
    .subtitle{ opacity:.8; margin:0 0 12px }
    .start{ margin-top:10px; font-weight:700; background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white; border:none; border-radius:999px; padding:14px 22px; font-size:clamp(16px,3.7vw,18px); box-shadow:0 10px 30px rgba(255,59,124,.35); }

    /* Modal at the end */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.25) }
    .modal.show{ display:grid }
    .modal .card{ padding:24px 18px }
    .heart{ display:inline-block; animation:beat 1s infinite ease-in-out; }
    @keyframes beat{ 0%,100%{ transform:scale(1)} 25%{ transform:scale(1.08)} 50%{ transform:scale(0.98)} 75%{ transform:scale(1.06)} }

    /* Yes / No Row */
    .choices{ display:flex; gap:.75rem; justify-content:center; flex-wrap:wrap; margin-top:12px }
    .choice{ border:none; border-radius:14px; padding:12px 16px; font-weight:700; cursor:pointer; }
    .yes{ background:linear-gradient(135deg, #22c55e, #16a34a); color:#fff; }
    .no{ background:linear-gradient(135deg, #f43f5e, #ef4444); color:#fff; position:relative; }

    /* Mobile-friendly text sizing */
    p{ font-size:clamp(14px, 3.6vw, 16px); margin:.25rem 0 }

    /* Tiny footer link zone */
    .footer{ position:fixed; left:0; right:0; bottom:8px; text-align:center; opacity:.65; font-size:12px; }
    .footer a{ color:#b4144a; text-decoration:none; font-weight:600 }
  </style>
</head>
<body>
  <canvas id="game" aria-label="Catch the hearts for Chinny"></canvas>

  <!-- Heads-up display -->
  <div class="hud">
    <div class="pill"><span>üíó Score:</span> <span id="score" class="score">0</span></div>
    <div class="pill"><span>‚è±Ô∏è Time:</span> <span id="time" class="score">60</span>s</div>
    <div class="pill btn" id="musicToggle" title="Music on/off">üéµ Music</div>
  </div>

  <!-- Start screen -->
  <div class="center" id="startScreen">
    <div class="card">
      <div style="font-size:42px">üíñ</div>
      <h1 class="title">For Chinny</h1>
      <p class="subtitle">Catch as many hearts as you can!<br/>Move with your finger (touch) or arrow keys.</p>
      <button class="start" id="startBtn">Start Game</button>
      <p style="margin-top:10px; opacity:.8">Made with love by <strong>You</strong> ‚Äî deploy on GitHub Pages and send her the link.</p>
    </div>
  </div>

  <!-- End modal -->
  <div class="modal" id="endModal" aria-modal="true" role="dialog">
    <div class="card">
      <div style="font-size:40px; margin-bottom:6px"><span class="heart">üíñ</span> <span class="heart">üíñ</span> <span class="heart">üíñ</span></div>
      <h2 class="title" style="font-size:clamp(24px,6vw,36px)">For Chinny</h2>
      <p id="finalText">You caught <b id="finalScore">0</b> hearts for Chinny!</p>
      <p style="margin-top:6px">Chinny, you make my heart do little happy dances. Will you go on a date with me? ü•∫</p>
      <div class="choices">
        <button class="choice yes" id="yesBtn">Yes! üíï</button>
        <button class="choice no" id="noBtn">No üò≥</button>
      </div>
    </div>
  </div>

  <div class="footer">Built for Chinny ‚Ä¢ <a href="#" id="restartLink">Play again</a></div>

  <!-- Soft music (royalty-free-ish vibe) ‚Äì replace with your own mp3 if you like -->
  <audio id="bgm" loop>
    <!-- You can replace the src with your own file path, e.g., assets/music.mp3 -->
    <source src="" type="audio/mpeg">
  </audio>

  <script>
    // ====== Utility drawing: heart path ======
    function drawHeart(ctx, x, y, size, fill, shadow=false){
      const s = size;
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(s/100, s/100);
      ctx.beginPath();
      // Parametric-ish cartoony heart
      ctx.moveTo(0, -0.25);
      ctx.bezierCurveTo(0.5, -0.95, 1.25, -0.1, 0, 0.9);
      ctx.bezierCurveTo(-1.25, -0.1, -0.5, -0.95, 0, -0.25);
      if (shadow){ ctx.shadowColor = 'rgba(0,0,0,.18)'; ctx.shadowBlur = 20; ctx.shadowOffsetY = 6; }
      if (fill instanceof CanvasGradient) ctx.fillStyle = fill; else ctx.fillStyle = fill || '#ff3b7c';
      ctx.fill();
      ctx.restore();
    }

    // ====== Game state ======
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const startScreen = document.getElementById('startScreen');
    const endModal = document.getElementById('endModal');
    const finalScoreEl = document.getElementById('finalScore');
    const finalText = document.getElementById('finalText');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const restartLink = document.getElementById('restartLink');
    const musicToggle = document.getElementById('musicToggle');
    const bgm = document.getElementById('bgm');

    let W = 0, H = 0;
    let playing = false;
    let score = 0;
    let timeLeft = 60; // seconds
    let hearts = [];
    let lastSpawn = 0;
    let player = { x: 0, y: 0, w: 90, h: 26, vx: 0 };
    let keys = new Set();

    // Resize canvas to device pixels for crispness
    function fit(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = canvas.clientWidth; H = canvas.clientHeight;
      canvas.width = Math.round(W * dpr);
      canvas.height = Math.round(H * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      // Position player near bottom
      player.y = H - 80; player.x = W/2;
    }
    window.addEventListener('resize', fit); fit();

    // Spawn falling hearts
    function spawnHeart(){
      const size = Math.random()*0.6 + 0.5; // scale factor
      hearts.push({ x: Math.random()*W, y: -30, vy: (Math.random()*0.7+0.8)*120, size });
    }

    // Simple gradient cache for hearts
    function heartGradient(x,y,size){
      const g = ctx.createRadialGradient(x+size*2, y-size*2, size*0.2, x, y, size*3);
      g.addColorStop(0,'#ff7aa8');
      g.addColorStop(1,'#ff2f74');
      return g;
    }

    // Input: keyboard
    window.addEventListener('keydown', e=>{ if (e.key==='ArrowLeft'||e.key==='ArrowRight') keys.add(e.key) });
    window.addEventListener('keyup', e=>{ keys.delete(e.key) });

    // Input: touch / mouse drag
    function pointerPos(e){
      const t = e.touches? e.touches[0] : e;
      const rect = canvas.getBoundingClientRect();
      return { x: (t.clientX - rect.left) }; // only X control needed
    }
    let dragging = false;
    canvas.addEventListener('pointerdown', e=>{ dragging=true; player.x = pointerPos(e).x });
    window.addEventListener('pointermove', e=>{ if (dragging) player.x = pointerPos(e).x });
    window.addEventListener('pointerup', ()=> dragging=false);

    // Music toggle (you can set a src on <audio> for real music)
    let musicOn = false;
    function toggleMusic(){
      musicOn = !musicOn;
      if (musicOn && bgm.src){ bgm.volume = 0.35; bgm.play().catch(()=>{}); }
      else { bgm.pause(); }
      musicToggle.textContent = musicOn? 'üîä Music' : 'üéµ Music';
    }
    musicToggle.addEventListener('click', ()=>{ toggleMusic(); });

    // Start / Restart
    document.getElementById('startBtn').addEventListener('click', startGame);
    restartLink.addEventListener('click', (e)=>{ e.preventDefault(); reset(); startGame(); });

    function reset(){
      score = 0; timeLeft = 60; hearts = []; lastSpawn = 0;
      keys.clear(); dragging=false; endModal.classList.remove('show');
      scoreEl.textContent = '0'; timeEl.textContent = '60';
      player.x = W/2; player.y = H-80;
    }

    function startGame(){
      reset();
      startScreen.style.display = 'none';
      playing = true;
      lastTick = performance.now();
      requestAnimationFrame(loop);
    }

    // Limited roam zone for the NO button (so it stays in the card area)
    const roam = { xMin: 40, xMax: 560, yMin: 20, yMax: 140 };
    noBtn.addEventListener('mouseenter', () => moveNo());
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveNo(); }, {passive:false});
    function moveNo(){
      const card = endModal.querySelector('.card').getBoundingClientRect();
      const maxX = Math.min(card.width - 100, Math.max(10, roam.xMax));
      const maxY = Math.min(card.height - 60, Math.max(10, roam.yMax));
      const nx = Math.random() * (maxX - roam.xMin) + roam.xMin;
      const ny = Math.random() * (maxY - roam.yMin) + roam.yMin;
      noBtn.style.transform = `translate(${nx}px, ${ny}px)`;
    }

    yesBtn.addEventListener('click', ()=>{
      finalText.innerHTML = `Yay! Chinny said <b>YES</b> \u2728 Date unlocked!`;
      noBtn.style.display = 'none';
    });

    // Countdown timer
    let lastTick = 0, accum = 0;
    function update(dt){
      if (!playing) return;
      // Keyboard movement
      const speed = 420;
      player.vx = 0;
      if (keys.has('ArrowLeft')) player.vx -= speed;
      if (keys.has('ArrowRight')) player.vx += speed;
      player.x += player.vx * dt;
      player.x = Math.max(40, Math.min(W-40, player.x));

      // Spawn hearts ~ every 220ms scaling with time
      lastSpawn += dt;
      const spawnRate = Math.max(0.12, 0.22 - (60-timeLeft)*0.002);
      if (lastSpawn > spawnRate){ lastSpawn = 0; spawnHeart(); }

      // Update hearts
      for (let i=hearts.length-1;i>=0;i--){
        const h = hearts[i];
        h.y += h.vy * dt;
        // Collision with player "basket"
        if (h.y > player.y-20 && h.y < player.y + player.h && Math.abs(h.x - player.x) < 60){
          hearts.splice(i,1); score += 1; scoreEl.textContent = score;
        } else if (h.y > H + 40){ hearts.splice(i,1); }
      }

      // Timer
      accum += dt;
      if (accum >= 1){
        accum -= 1; timeLeft -= 1; timeEl.textContent = timeLeft;
        if (timeLeft <= 0){ endGame(); }
      }
    }

    function endGame(){
      playing = false;
      finalScoreEl.textContent = score;
      finalText.innerHTML = `You caught <b>${score}</b> hearts for Chinny!`;
      endModal.classList.add('show');
    }

    function drawBackground(){
      // Soft floating hearts background
      ctx.clearRect(0,0,W,H);
      const count = 16;
      for (let i=0;i<count;i++){
        const x = ((i*97) % W) + (Math.sin(performance.now()/1000 + i)*40);
        const y = (i/count) * H;
        drawHeart(ctx, x, y, 12, 'rgba(255,59,124,.08)');
      }
    }

    function drawPlayer(){
      // Cute rounded basket
      ctx.save();
      ctx.translate(player.x, player.y);
      // shadow
      ctx.fillStyle = 'rgba(0,0,0,.12)';
      ctx.beginPath(); ctx.ellipse(0, 30, 50, 10, 0, 0, Math.PI*2); ctx.fill();
      // basket body
      const grd = ctx.createLinearGradient(-70, -20, 70, 20);
      grd.addColorStop(0, '#ffb3cd'); grd.addColorStop(1, '#ff7aa8');
      ctx.fillStyle = grd; ctx.strokeStyle = '#ffffff'; ctx.lineWidth = 2;
      const r = 16; const w = 120; const h = 26;
      ctx.beginPath();
      ctx.moveTo(-w/2 + r, -h/2);
      ctx.arcTo(w/2, -h/2, w/2, h/2, r);
      ctx.arcTo(w/2, h/2, -w/2, h/2, r);
      ctx.arcTo(-w/2, h/2, -w/2, -h/2, r);
      ctx.arcTo(-w/2, -h/2, w/2, -h/2, r);
      ctx.closePath(); ctx.fill(); ctx.stroke();
      // little hearts on basket
      drawHeart(ctx, -22, -2, 10, '#fff');
      drawHeart(ctx, 0, -2, 10, '#fff');
      drawHeart(ctx, 22, -2, 10, '#fff');
      ctx.restore();
    }

    function drawHearts(){
      for (const h of hearts){
        const size = 22; // px$1drawHeart(ctx, h.x, h.y, size, g, true);
      }
    }

    function loop(ts){
      if (!playing) return;
      const dt = Math.min(0.033, (ts - lastTick)/1000); // clamp
      lastTick = ts;
      update(dt);
      drawBackground();
      drawHearts();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    // Autofit on load after fonts
    window.addEventListener('load', fit);
  </script>
</body>
</html>
